<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Estoque Geral</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <header>
        <h1>Estoque Geral de Produtos</h1>
    </header>
    <main>
        <section class="tabela-container">
            <h2>Lista Completa de Itens</h2>
            <div id="loading" class="status-message">Carregando dados...</div>
            <table id="tabelaProdutos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Marca</th>
                        <th>Volume</th>
                        <th>Aplicação</th>
                        <th>Estoque Atual</th>
                        <th>Estoque Mínimo</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </section>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', carregarProdutos);

        async function carregarProdutos() {
            const loadingElement = document.getElementById('loading');
            const tbody = document.querySelector('#tabelaProdutos tbody');
            tbody.innerHTML = ''; 

            try {
                
                // tenta carregar os dados da api
                const response = await fetch('http://localhost:3001/produtos');
                
                if (!response.ok) {
                    // se a api retornar um status de erro (404, 500, etc.)
                    const erroData = await response.json();
                    throw new Error(erroData.Msg || 'Falha ao buscar dados: ' + response.statusText);
                }
                
                const produtos = await response.json();
                loadingElement.style.display = 'none';

                if (produtos.length === 0) {
                    loadingElement.textContent = 'Nenhum produto cadastrado.';
                    loadingElement.style.display = 'block';
                    return;
                }

                produtos.forEach(produto => {
                    const row = tbody.insertRow();
                    // garantir que as propriedades estão corretas, de acordo com o banco de dados:
                    // id, nome, marca, volume, tipo_embalagem, aplicacao, quantidade, estoque_minimo
                    row.insertCell().textContent = produto.id;
                    row.insertCell().textContent = produto.nome;
                    row.insertCell().textContent = produto.marca;
                    row.insertCell().textContent = produto.volume;
                    row.insertCell().textContent = produto.aplicacao;
                    
                    const quantidadeCell = row.insertCell();
                    quantidadeCell.textContent = produto.quantidade;
                    
                  
                    if (produto.quantidade < produto.estoque_minimo) {
                        quantidadeCell.style.fontWeight = 'bold';
                        quantidadeCell.style.color = 'red';
                    }

                    row.insertCell().textContent = produto.estoque_minimo;
                });

            } catch (error) {
                
                loadingElement.textContent = 'Erro ao carregar estoque.';
                loadingElement.classList.add('error');
                console.error('Falha na comunicação:', error.message);
            }
        }
    </script>
</body>
</html>
</body>
</html>
</body>

</html>
